# Technical Context

## 决策记录

| 决策 | 选择 | 理由 |
|------|------|------|
| 存储方式 | 文件系统 (.md) | 简单、版本控制友好、无需 UI |
| 检测方式 | 语义理解 | 关键词太死板，语义更准确 |
| 检测模型 | 复用主模型 | 避免引入额外配置 |
| 注入位置 | System Prompt 末尾 | 最简单、兼容性最好 |
| 多 patch | 全部注入 | 避免复杂的优先级逻辑 |

## Patch 文件格式

```markdown
---
id: acf
trigger: 用户在讨论 WordPress 自定义字段、ACF、内容建模
---

## 输出要求

当涉及 {{topic}} 时，最终输出需要明确：

1. **字段设置**
   - 字段类型选择
   - 字段配置建议

2. **Taxonomy 设计**
   - 需要哪些分类法
   - 每个 Taxonomy 的 meta 字段

3. **Post Types**
   - 需要哪些自定义文章类型
   - 各 Post Type 关联的字段组
```

## 技术约束

- Patch 检测在每次请求时执行（无缓存）
- 使用同一个 LLM 调用完成检测（单次判断所有 patch）
- 变量由 AI 在检测时动态填充（根据上下文理解）
- 检测 prompt 要求 LLM 保守匹配（明确相关才匹配）
- 记录匹配日志用于后续分析误报率

## 评审决策

| 问题 | 决策 | 理由 |
|------|------|------|
| 匹配阈值 | 暗示 LLM 保守匹配 | 宁漏勿错 |
| 误判风险 | 加日志记录 | 观察实际效果再调整 |
| 变量歧义 | 接受风险 | 错了影响不大 |
| patch 冲突 | 设计时避免 | MVP 只有一个 patch |
